class HazardBehavior : ZilchComponent
{
    [Property]
    var ActiveTime : Real = 1;
    
    [Property]
    var CoolDown : Real = 1;
    
    [Property]
    var Damage : Integer = 2;
    
    var Timer : Real = 0;
    var Active : Boolean = false;
    
    [Property]
    var Enabled : Boolean = true;
    
    [Property]
    var EmitRateMultiplier : Real = 1; //useful if you want to scale up the space
    
    [Property]
    var AttackCooldown : Real = 0.4;
    
    var InternalCooldown : Real = 0;
    
    function Initialize(init : CogInitializer)
    {
        Zero.Connect(this.Space, Events.LogicUpdate, this.OnLogicUpdate);
        this.Owner.EntityAttack.AttackCollision = MultiConvexMesh.Square;
        this.Owner.EntityAttack.MinRange = 0;
        this.Owner.EntityAttack.Damage = this.Damage;
    }

    function OnLogicUpdate(event : UpdateEvent)
    {
        if(this.Enabled)
        {
            this.Timer -= event.Dt;
            if(this.Timer <= 0)
            {
                this.Active = !this.Active;
                if(this.Active)
                {
                    this.Owner.BoxParticleEmitter.EmitRate = 100 * this.EmitRateMultiplier;
                    this.Owner.EntityAttack.TracerLifetime = this.AttackCooldown;
                    
                    this.Timer = this.ActiveTime;
                } else {
                    this.Owner.BoxParticleEmitter.EmitRate = 1 * this.EmitRateMultiplier;
                    this.Timer = this.CoolDown;
                }
            }
            if(this.Active)
            {
                this.InternalCooldown -= event.Dt;
                if(this.InternalCooldown < 0.01)
                {
                    this.InternalCooldown = this.AttackCooldown;
                    this.Owner.EntityAttack.Attack(Real3(0,0,0));
                }
            }
        } else {
            this.Owner.BoxParticleEmitter.EmitRate = 1;
            this.Timer = this.CoolDown;
        }
    }
}
